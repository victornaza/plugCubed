/*
 Copyright (c) 2012-2013 by Jeremy "Colgate" Richardson and Thomas "TAT" Andresen

 Permission to use and/or distribute this software or parts of it for any purpose without
 fee is hereby granted, provided that the above copyright notice and this permission notice
 appear in all copies.

 Permission to copy and/or edit this software or parts of it for any purpose is NOT permitted
 without written permission by the authors.

 THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHORS DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE
 INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHORS
 BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER
 RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
 OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

 @author  Jeremy "Colgate" Richardson
 @author  Thomas "TAT" Andresen
*/
var d=void 0,e=!0,f=null,h=!1;"undefined"!==typeof plugCubed&&plugCubed.close();Math.Qa=function(){return 1+Math.floor(10*Math.random())};Emoji.H=Emoji.emojify;console.info=function(a){console.log(a);q!==d?(log('<span style="color:#FF0000">'+plugCubed.d("disconnected",[plugCubed.S()])+" "+plugCubed.d("reloading")+"</span>"),setTimeout(function(){location.reload(e)},3E3)):s||(s=e,log('<span style="color:#FF0000">'+plugCubed.d("disconnected",[plugCubed.S()])+"</span>"))};
var q,s=h,u=Class.extend({K:{},R:function(){return"undefined"!==typeof pdpSocket&&"http://socket.plugpony.net:9000/gateway"===pdpSocket._base_url},version:{major:1,minor:7,patch:0},init:function(){this.proxy={menu:$.proxy(this.onMenuClick,this),W:$.proxy(this.W,this),onVoteUpdate:$.proxy(this.onVoteUpdate,this),V:$.proxy(this.V,this),X:$.proxy(this.X,this),Y:$.proxy(this.Y,this),U:$.proxy(this.U,this),i:$.proxy(this.i,this),u:$.proxy(this.u,this)};localStorage.ca!==d&&($.getScript("https://rawgithub.com/TATDK/plugCubed/1.7.0/langs/lang."+
localStorage.ca+".js",$.proxy(this.za,this)),"undefined"===typeof jQuery.fn.tabs&&($.getScript("http://code.jquery.com/ui/1.10.2/jquery-ui.js"),$("head").append('<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />')))},d:function(a,b){var c=this.lang,g;a=a.split(".");for(g in a){if(c[a[g]]===d)return"{"+a.join(".")+"}";c=c[a[g]]}if(b)for(g in b)c=c.split("%"+g).join(b[g]);return c},za:function(){this.na=h;this.colors={Ra:"66FFFF",oa:"FF0000",D:"FFFF00",
g:"66FFFF"};this.ka=this.d("AFK");setTimeout(function(){plugCubed.history=[];plugCubed.Ca()},1);this.Q=$('<style type="text/css"></css>');$("head").append(this.Q);this.log("Running plug&#179; version "+this.version.major+"."+this.version.minor+"."+this.version.patch,f,this.colors.D);this.log("Use '/commands' to see expanded chat commands.",f,this.colors.g);Dialog.qa=function(a,b){this.closeDialog();var c=a;b!==d&&(c='<div id="plugCubedCommands"><ul><li><a href="#user">'+plugCubed.d("userCommands")+
'</a></li><li><a href="#mod">'+plugCubed.d("modCommands")+'</a></li></ul><div id="user">'+a+'</div><div id="mod">'+b+"</div></div>");this.showDialog($("<div/>").attr("id","dialog-alert").addClass("dialog").css("left",Main.LEFT+(Main.WIDTH-620-15)/2).css("top",200).width(645).height(470).append(this.getHeader(plugCubed.d("commandsTitle"))).append($("<div/>").addClass("dialog-body").append(this.getMessage(c).width(620))));$("#plugCubedCommands").tabs()};Lobby.onRoomSelectResponse=function(a){this.spin(h);
this.pendingLoad=h;var b=this.data.length;this.lastCursor=a.cursor;if(0==a.results.length)this.endOfList=e;else if((this.data=this.data.concat(a.results))&&0<this.data.length){this.roomList||(this.roomList=$("<ul/>").addClass("room-list"));a=this.data.length;for(var c=b;c<a;++c){var l=this.data[c],m=$("<div/>").addClass("room-population").append($("<span/>").addClass("room-population-value").text(l.userCount)).append($("<span/>").addClass("room-population-label").html(Lang.lobby.population)),p=$("<div/>").addClass("meta").append($("<span/>").addClass("room-name").text(l.name)).append($("<span/>").addClass("room-hosted-by").text(Lang.lobby.hostedBy)).append($("<span/>").addClass("room-host-name").text(l.host));
l.media&&p.append($("<span/>").addClass("room-now-playing").text(Lang.lobby.nowPlaying)).append($("<span/>").addClass("room-media").text(l.media));var n=$("<div/>").addClass("room-djs");if(5>l.djCount){var t;t=4==l.djCount?Lang.lobby.slotAvailable:Lang.lobby.slotsAvailable.split("%COUNT%").join(""+(5-l.djCount));n.append($("<span/>").addClass("room-djs-label").text(t))}else n.append($("<span/>").addClass("room-djs-label").text(Lang.lobby.noSlots));p.append(n);l.friends&&0<l.friends.length&&l.userCount&&
(n=1==l.friends.length?Lang.lobby.friendInHere:Lang.lobby.friendsInHere.split("%COUNT%").join(""+l.friends.length),p.append($("<div/>").addClass("room-friends").append($("<span/>").addClass("room-friends-label").text(n)).attr("title",l.friends.join(", "))));l=$("<li/>").addClass("room-list-item").data("index",c).data("room",l).mouseenter($.proxy(this.onRoomOver,this)).mouseleave($.proxy(this.onRoomOut,this)).click($.proxy(this.onRoomClick,this)).append(m).append(p);1==c%2?l.addClass("alternate-cell"):
l.removeClass("alternate-cell");this.roomList.append(l)}0==b&&this.lobbyPanelList.append(this.roomList);this.posLobbyLabels()}else Dialog.alert(Lang.alerts.roomNotFound)};Models.chat.G===d&&(Models.chat.G=Models.chat.chatCommand);ChatModel.G===d&&(ChatModel.G=ChatModel.chatCommand);Models.chat.chatCommand=this.ja;ChatModel.chatCommand=this.ja;this.Ha();$("body").prepend('<link rel="stylesheet" type="text/css" id="plugcubed-css" href="https://rawgithub.com/TATDK/plugCubed/1.7.0/plugCubed.css" />');
$("body").append('<div id="side-left" class="sidebar"><div class="sidebar-content"></div></div><div id="side-right" class="sidebar"><div class="sidebar-handle"><span>||</span></div><div class="sidebar-content"></div></div>').append('<script type="text/javascript" src="https://rawgithub.com/TATDK/plugCubed/1.7.0/thirdparty.js">\x3c/script>');this.Ea();this.Da();this.settings.userlist?(this.Z(),this.da()):this.la();var a=API.getUsers(),b;for(b in a){var c=a[b];c.A===d&&(c.A=0);c.F===d&&(c.F=0);c.C===
d&&(c.C=0);c.joinTime===d&&(c.joinTime=this.S())}SocketListener.chat=function(a){if("undefined"!==typeof plugCubed&&a.fromID&&-1<plugCubed.settings.L.indexOf(a.fromID))return plugCubed.ha(a);Models.chat.receive(a);API.delayDispatch(API.CHAT,a)};EXT||(EXT={});EXT.onRoomJoined?(EXT.ga||(EXT.ga=EXT.onRoomJoined),EXT.onRoomJoined=function(){"undefined"!==typeof plugCubed&&(plugCubed.close(),plugCubed=new u);EXT.ga()}):EXT.onRoomJoined=function(){"undefined"!==typeof plugCubed&&(plugCubed.close(),plugCubed=
new u)};this.fa()},close:function(){Models.chat.chatCommand=Models.chat.G;ChatModel.chatCommand=ChatModel.G;API.removeEventListener(API.DJ_ADVANCE,this.proxy.W);API.removeEventListener(API.VOTE_UPDATE,this.proxy.onVoteUpdate);API.removeEventListener(API.CURATE_UPDATE,this.proxy.V);API.removeEventListener(API.USER_JOIN,this.proxy.X);API.removeEventListener(API.USER_LEAVE,this.proxy.Y);API.removeEventListener(API.CHAT,this.proxy.U);API.removeEventListener(API.VOTE_SKIP,this.proxy.u);API.removeEventListener(API.USER_SKIP,
this.proxy.u);API.removeEventListener(API.MOD_SKIP,this.proxy.u);API.removeEventListener(API.WAIT_LIST_UPDATE,this.proxy.i);API.removeEventListener("userUpdate",this.proxy.i);for(var a in plugCubed.K)a===d||plugCubed.K[a]===d||($("#plugcubed-btn-"+a).unbind(),delete plugCubed.K[a]);$("#plugcubed-css").remove();$("#plugcubed-js-extra").remove();$("#side-right").remove();$("#side-left").remove();this.Q.remove();this.z.onclose=function(){};this.z.close();delete plugCubed},fa:function(){this.z=new SockJS("http://socket.plugpony.net:923/gateway");
this.z.N=0;this.z.onopen=function(){this.N=0;this.send(JSON.stringify({id:Models.user.data.id,username:Models.user.data.username,room:Models.room.data.id,version:plugCubed.version.major+"."+plugCubed.version.minor+"."+plugCubed.version.patch}))};this.z.onmessage=function(a){"update"===JSON.parse(a.data).type&&(plugCubed.z.onclose=function(){},plugCubed.z.close(),plugCubed.log(plugCubed.d("newVersion"),f,plugCubed.colors.D),setTimeout(function(){$.getScript("https://rawgithub.com/TATDK/plugCubed/1.7.0/plugCubed."+
(plugCubed.na?"min.":"")+"js")},5E3))};this.z.onclose=function(){this.N++;var a;if(5>this.N)a=5;else if(30>this.N)a=30;else if(60>this.N)a=60;else return;setTimeout(function(){plugCubed.fa()},1E3*a)}},da:function(){$("#side-left").show().animate({left:"0px"},300,"undefined"===typeof jQuery.easing.Ba?d:"easeOutQuart");this.R()&&(userlistShow===e&&$("#pdpUsers").hide(),$("#pdpUsersToggle").hide())},la:function(){var a=-$("#side-left").width()-20;$("#side-left").animate({left:a+"px"},300,"undefined"===
typeof jQuery.easing.Ba?d:"easeOutQuart",function(){$("#side-left").hide()});this.R()&&(userlistShow===e&&$("#pdpUsers").show(),$("#pdpUsersToggle").show())},aa:{you:{title:"ranks.you",color:"FFDD6F"},regular:{title:"ranks.regular",color:"B0B0B0"},featureddj:{title:"ranks.featureddj",color:"E90E82"},bouncer:{title:"ranks.bouncer",color:"E90E82"},manager:{title:"ranks.manager",color:"E90E82"},cohost:{title:"ranks.cohost",color:"E90E82"},host:{title:"ranks.host",color:"E90E82"},ambassador:{title:"ranks.ambassador",
color:"9A50FF"},admin:{title:"ranks.admin",color:"42A5DC"},join:{title:"join",color:"3366FF"},leave:{title:"leave",color:"3366FF"},curate:{title:"curate",color:"00FF00"},va:{title:"stats",color:"66FFFF"},xa:{title:"updates",color:"FFFF00"}},settings:{recent:h,awaymsg:"",autowoot:h,autojoin:h,userlist:h,autorespond:h,menu:h,notify:h,customColors:h,I:e,P:e,q:[],L:[],B:h,k:{enabled:h,limit:50},colors:{you:"FFDD6F",regular:"B0B0B0",featureddj:"E90E82",bouncer:"E90E82",manager:"E90E82",cohost:"E90E82",
host:"E90E82",ambassador:"9A50FF",admin:"42A5DC",join:"3366FF",leave:"3366FF",curate:"00FF00",va:"66FFFF",xa:"FFFF00"},alerts:{join:h,leave:h,curate:h,ta:h,ra:h}},Ha:function(){if(localStorage.pa!==d){var a=JSON.parse(localStorage.pa),b;for(b in this.settings)a[b]!==d&&(this.settings[b]=a[b]);this.settings.recent=h;this.settings.autowoot&&this.ya();this.settings.userlist&&(this.Z(),this.da());this.settings.customColors&&this.wa();0<this.settings.q.length&&-1<this.settings.q.indexOf(Models.room.data.media.id)&&
(Playback.setVolume(0),this.settings.B=e,this.log(this.d("automuted",[Models.room.data.media.title]),f,this.colors.g));this.settings.I||(Emoji.H===d&&(Emoji.H=Emoji.emojify),Emoji.emojify=function(a){return a})}},saveSettings:function(){localStorage.pa=JSON.stringify(this.settings)},wa:function(){this.settings.customColors?this.Q.text([".chat-message .chat-from,",".chat-mention .chat-from { color:#"+this.settings.colors.regular+"!important; }",".chat-message .chat-from-featureddj,",".chat-mention .chat-from-featureddj { color:#"+
this.settings.colors.featureddj+"!important; }",".chat-message .chat-from-bouncer,",".chat-mention .chat-from-bouncer { color:#"+this.settings.colors.bouncer+"!important; }",".chat-message .chat-from-manager,",".chat-mention .chat-from-manager { color:#"+this.settings.colors.manager+"!important; }",".chat-message .chat-from-cohost,",".chat-mention .chat-from-cohost { color:#"+this.settings.colors.cohost+"!important; }",".chat-message .chat-from-host,",".chat-mention .chat-from-host { color:#"+this.settings.colors.host+
"!important; }",".chat-message .chat-from-ambassador,",".chat-mention .chat-from-ambassador { color:#"+this.settings.colors.ambassador+"!important; }",".chat-message .chat-from-admin,",".chat-mention .chat-from-admin { color:#"+this.settings.colors.admin+"!important; }",".chat-message .chat-from-you,",".chat-mention .chat-from-you { color:#"+this.settings.colors.you+"!important; }"].join("\n")):this.Q.text("")},Da:function(){API.addEventListener(API.DJ_ADVANCE,this.proxy.W);API.addEventListener(API.VOTE_UPDATE,
this.proxy.onVoteUpdate);API.addEventListener(API.CURATE_UPDATE,this.proxy.V);API.addEventListener(API.USER_JOIN,this.proxy.X);API.addEventListener(API.USER_LEAVE,this.proxy.Y);API.addEventListener(API.CHAT,this.proxy.U);API.addEventListener(API.VOTE_SKIP,this.proxy.u);API.addEventListener(API.USER_SKIP,this.proxy.u);API.addEventListener(API.MOD_SKIP,this.proxy.u);API.addEventListener(API.WAIT_LIST_UPDATE,this.proxy.i);API.addEventListener("userUpdate",this.proxy.i)},Ea:function(){$("#side-right .sidebar-content").html("");
this.j(this.settings.autowoot,"woot",this.d("autowoot"));this.j(this.settings.autojoin,"join",this.d("autojoin"));this.j(this.settings.userlist,"userlist",this.d("userlist"));this.j(this.settings.customColors,"colors",this.d("customchat"));this.j(this.settings.autorespond,"autorespond",this.d("afkstatus"));this.j(this.settings.notify,"notify",this.d("notify"));this.j(this.settings.k.enabled,"chatlimit",this.d("limitchat"));this.j(!DB.settings.streamDisabled,"stream",this.d("stream"));this.j(this.settings.I,
"emoji",this.d("emoji"));this.j(this.settings.P,"avataranim",this.d("avatarAnimations"))},j:function(a,b,c){this.K[b]===d&&(0<$("#side-right .sidebar-content").children().length&&$("#side-right .sidebar-content").append("<hr />"),$("#side-right .sidebar-content").append('<a id="plugcubed-btn-'+b+'"><div class="status-'+(a?"on":"off")+'"></div>'+c+"</a>"),$("#plugcubed-btn-"+b).data("key",b).click(this.proxy.menu),this.K[b]={text:c})},f:function(a,b){$("#plugcubed-btn-"+a).find('[class^="status-"], [class*=" status-"]').attr("class",
"status-"+(b===e?"on":"off"))},Z:function(){0<$("#side-left .sidebar-content").children().length&&$("#side-left .sidebar-content").append("<hr />");$("#side-left .sidebar-content").bind("contextmenu",function(){return h});$("#side-left .sidebar-content").html('<h1 class="users">Users: '+API.getUsers().length+"</h1>");var a=Models.room.getWaitListPosition(),a=$("<h3></h3>").addClass("waitlistspot").text("Waitlist: "+(a!==f?a+" / ":"")+Models.room.data.waitList.length);$("#side-left .sidebar-content").append(a).append("<hr />");
var a=API.getUsers(),b;for(b in a)this.Aa(a[b])},log:function(a,b,c,g){var k="";c&&(k=' style="color:'+("#"===c.substr(0,1)?c:"#"+c)+';"');a=b?'<div class="chat-message"><span class="chat-from"'+k+">"+b+'</span><span class="chat-text"'+k+">: "+a+"</span></div>":'<div class="chat-message"><span class="chat-text"'+k+">"+a+"</span></div>";$("#chat-messages");$("#chat-messages").scrollTop();$("#chat-messages").outerHeight();b=Popout?Popout.Chat.chatMessages:Chat.chatMessages;c=b.scrollTop()>b[0].scrollHeight-
b.height()-20;b.append(a);c&&b.scrollTop(b[0].scrollHeight);g&&$(a).click(function(){this.childNodes[0].style.color=g})},Aa:function(a){var b=Utils.cleanTypedString(a.username),c;c=a.curated==e?"curate":this.J(a.id)?"plugcubed":this.ma(a.id)?"vip":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.FEATUREDDJ?"fdj":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.BOUNCER?"bouncer":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.MANAGER?
"manager":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.COHOST?"host":Models.room.data.staff[a.id]&&5==Models.room.data.staff[a.id]?"host":Models.room.ambassadors[a.id]?"ambassador":Models.room.admins[a.id]?"admin":"normal";0<Models.room.data.djs.length&&Models.room.data.djs[0].user.id==a.id?"normal"===c?this.O("void","#66FFFF",b):this.O(c+"_current","#66FFFF",b):"normal"===c?this.O("void",this.ia(a.vote),b):this.O(c+this.Pa(a.vote),this.ia(a.vote),b)},ia:function(a){var b=
"";if(a===d)b="FFFFFF";else switch(a){case -1:b="ED1C24";break;case 1:b="3FFF00";break;default:b="FFFFFF"}return"#"+b},Pa:function(a){var b="";if(a===d)b="undecided";else switch(a){case -1:b="meh";break;case 1:b="woot";break;default:b="undecided"}return"_"+b},O:function(a,b,c){$("#side-left .sidebar-content").append($("<p></p>").append($("<span></span>").append($("<span></span>").addClass(a)).css("cursor","pointer").css("color",b).mousedown(function(a){switch(a.which){case 1:$("#chat-input-field").val($("#chat-input-field").val()+
"@"+c+" ").focus();break;case 3:(Models.room.data.staff[Models.user.data.id]&&Models.room.data.staff[Models.user.data.id]>=Models.user.BOUNCER||plugCubed.J(Models.user.data.id))&&plugCubed.T(c)}}).html(function(a,b){return b+c})))},getUser:function(a){a=a.trim();"@"===a.substr(0,1)&&(a=a.substr(1));var b=API.getUsers(),c;for(c in b)if(("string"!==typeof a?0:b[c].username.toLowerCase()===a.toLowerCase())||("string"!==typeof a?0:b[c].id.toLowerCase()===a.toLowerCase()))return b[c];return f},ba:function(a,
b){if(Models.room.data.staff[Models.user.data.id]&&Models.room.data.staff[Models.user.data.id]>=Models.user.BOUNCER){var c;switch(b){case "kick":c=ModerationKickUserService;break;case "removedj":c=ModerationRemoveDJService;break;case "adddj":c=ModerationAddDJService;break;default:log(this.d("unknownmoderation"));return}var g=this.getUser(a);g===f?log(this.d("usernotfound")):new c(g.id," ")}},T:function(a){a=this.getUser(a);if(a===f)log("User not found");else{var b,c,g,k,r=a.djPoints+a.curatorPoints+
a.listenerPoints,l=a.A+a.F;c=Models.room.getWaitListPosition(a.id);var m=-1;b=Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.FEATUREDDJ?this.d("ranks.featureddj"):Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.BOUNCER?this.d("ranks.bouncer"):Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.MANAGER?this.d("ranks.manager"):Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.COHOST?this.d("ranks.cohost"):Models.room.data.staff[a.id]&&
5==Models.room.data.staff[a.id]?this.d("ranks.host"):Models.room.ambassadors[a.id]?this.d("ranks.ambassador"):Models.room.admins[a.id]?this.d("ranks.admin"):this.d("ranks.regular");if(c===f)if(0<Models.room.data.djs.length&&Models.room.data.djs[0].user.id===a.id)k=this.d("currentlydjing"),m=0;else{for(c=1;c<Models.room.data.djs.length;c++)m=Models.room.data.djs[c].user.id===a.id?c:m;k=0>m?this.d("notinwaitlistnorbooth"):this.d("inbooth",[m+1,Models.room.data.djs.length])}else k=this.d("inwaitlist",
[c,Models.room.data.waitList.length]);switch(a.status){case -1:c=this.d("status.idle");break;default:c=this.d("status.available");break;case 1:c=this.d("status.afk");break;case 2:c=this.d("status.working");break;case 3:c=this.d("status.sleeping")}switch(a.vote){case -1:g=this.d("vote.meh");break;default:g=this.d("vote.undecided");break;case 1:g=this.d("vote.woot")}0===m&&(g=this.d("vote.djing"));log('<table style="width:100%;color:#CC00CC"><tr><td colspan="2"><strong>Name</strong>: <span style="color:#FFFFFF">'+
a.username+"</span></td></tr>"+(this.J(a.id)?'<tr><td colspan="2"><strong>Title</strong>: <span style="color:#FFFFFF">plugCubed Developer</span></td></tr>':"")+(this.ma(a.id)?'<tr><td colspan="2"><strong>Title</strong>: <span style="color:#FFFFFF">plugCubed VIP</span></td></tr>':"")+'<tr><td colspan="2"><strong>ID</strong>: <span style="color:#FFFFFF">'+a.id+'</span></td></tr><tr><td><strong> Rank</strong>: <span style="color:#FFFFFF">'+b+'</span></td><td><strong>Time Joined</strong>: <span style="color:#FFFFFF">'+
a.joinTime+'</span></td></tr><tr><td><strong>Status</strong>: <span style="color:#FFFFFF">'+c+'</span></td><td><strong> Vote</strong>: <span style="color:#FFFFFF">'+g+'</span></td></tr><tr><td colspan="2"><strong>Position</strong>: <span style="color:#FFFFFF">'+k+'</span></td></tr><tr><td><strong>Points</strong>: <span style="color:#FFFFFF" title = "'+a.djPoints+"  DJ Points  +  "+a.listenerPoints+"  Listener Points  +  "+a.curatorPoints+'  Curator Points">'+r+'</span></td><td><strong> Fans</strong>: <span style="color:#FFFFFF">'+
a.fans+'</span></td></tr><tr><td><strong>Woot Count</strong>: <span style="color:#FFFFFF">'+a.A+'</span></td><td><strong>Meh Count</strong>: <span style="color:#FFFFFF">'+a.F+'</span></td></tr><tr><td colspan="2"><strong>Woot/Meh ratio</strong>: <span style="color:#FFFFFF">'+(0===l?"0":(a.A/l).toFixed(2))+"</span></td></tr></table>")}},onMenuClick:function(a){a=$(a.currentTarget).data("key");switch(a){case "woot":this.settings.autowoot=!this.settings.autowoot;this.f("woot",this.settings.autowoot);
this.settings.autowoot&&$("#button-vote-positive").click();break;case "join":this.settings.autojoin=!this.settings.autojoin;this.f("join",this.settings.autojoin);this.settings.autojoin&&0<$("#button-dj-waitlist-join").length&&API.waitListJoin();break;case "userlist":this.settings.userlist=!this.settings.userlist;this.f("userlist",this.settings.userlist);this.settings.userlist?(this.Z(),this.da()):($("#side-left .sidebar-content").empty(),this.la());break;case "colors":Dialog.closeDialog();a=$("<form/>").submit("return false").append(Dialog.getCheckBox("Enable custom",
"enabled",this.settings.customColors));var b=0,c;for(c in this.aa)a.append($(Dialog.getInputField(c,this.d(this.aa[c].title),this.aa[c].color,this.settings.colors[c],6).css("top",30*++b)).change(function(){$(this).find(".dialog-input-label").css("color","#"+$(this).find("input").val())}));a=$("<div/>").addClass("dialog-body").append(a);for(c in this.settings.colors)a.find('input[name="'+c+'"]').parents(".dialog-input-container").find(".dialog-input-label").css("color","#"+this.settings.colors[c]);
Dialog.context="isCustomChatColors";Dialog.submitFunc=$.proxy(this.Ka,this);return Dialog.showDialog($("<div/>").attr("id","dialog-custom-colors").addClass("dialog").css("left",Main.LEFT+(Main.WIDTH-230)/2).css("top",208.5).append(Dialog.getHeader("Custom Chat Colors")).append(a).append($("<div/>").addClass("dialog-button dialog-default-button").click($.proxy(this.Ja,this)).append($("<span/>").text("Default"))).append(Dialog.getCancelButton()).append(Dialog.getSubmitButton(Lang.dialog.save)));case "autorespond":this.settings.autorespond=
!this.settings.autorespond;this.f("autorespond",this.settings.autorespond);if(this.settings.autorespond){a=prompt("Please enter your away message here.\nThis is what you will reply via @mention.",""===this.settings.awaymsg?this.ka:this.settings.awaymsg);if(a===f){this.settings.autorespond=h;this.f("autorespond",h);return}a=a.split("@").join("").trim();this.settings.awaymsg=""===a?this.ka:a;0>=Models.user.data.status&&Models.user.changeStatus(1)}else Models.user.changeStatus(0);break;case "notify":return Dialog.closeDialog(),
Dialog.context="isNotifySettings",Dialog.submitFunc=$.proxy(this.Oa,this),Dialog.showDialog($("<div/>").attr("id","dialog-notify").addClass("dialog").css("left",Main.LEFT+(Main.WIDTH-230)/2).css("top",208.5).append(Dialog.getHeader("Chat Notifications")).append($("<div/>").addClass("dialog-body").append($("<form/>").submit("return false").append(Dialog.getCheckBox("Enable alerts","enabled",this.settings.notify).css("top",10).css("left",10)).append(Dialog.getCheckBox("User Join","join",this.settings.alerts.join).css("top",
30).css("left",30)).append(Dialog.getCheckBox("User Leave","leave",this.settings.alerts.leave).css("top",50).css("left",30)).append(Dialog.getCheckBox("User Curate","curate",this.settings.alerts.curate).css("top",70).css("left",30)).append(Dialog.getCheckBox("Song Stats","songStats",this.settings.alerts.ra).css("top",90).css("left",30)).append(Dialog.getCheckBox("Song Updates","songUpdate",this.settings.alerts.ta).css("top",110).css("left",30)))).append(Dialog.getCancelButton()).append(Dialog.getSubmitButton(Lang.dialog.save)));
case "chatlimit":return Dialog.closeDialog(),Dialog.context="isChatLimitSettings",Dialog.submitFunc=$.proxy(this.Ia,this),Dialog.showDialog($("<div/>").attr("id","dialog-chat-limit").addClass("dialog").css("left",Main.LEFT+(Main.WIDTH-230)/2).css("top",208.5).append(Dialog.getHeader("Limit Chat Log")).append($("<div/>").addClass("dialog-body").append($("<form/>").submit("return false").append(Dialog.getCheckBox("Enable","enabled",this.settings.k.enabled).css("top",10).css("left",10)).append(Dialog.getInputField("chat-limit",
"Limit",0,this.settings.k.limit).css("top",30).css("left",10)))).append(Dialog.getCancelButton()).append(Dialog.getSubmitButton(Lang.dialog.save)));case "stream":return this.f("stream",DB.settings.streamDisabled),API.sendChat(DB.settings.streamDisabled?"/stream on":"/stream off");case "emoji":this.settings.I=!this.settings.I;this.f("emoji",this.settings.I);if(this.settings.I){if(Emoji.H===d)return this.log("Error in reenabling Emoji",f,this.colors.oa);Emoji.emojify=Emoji.H}else Emoji.H===d&&(Emoji.H=
Emoji.emojify),Emoji.emojify=function(a){return a};break;case "avataranim":this.settings.P=!this.settings.P;animSpeed=this.settings.P?83:Infinity;break;default:return console.log("Unknown menu key")}this.saveSettings()},Oa:function(){this.settings.notify=$("#dialog-checkbox-enabled").is(":checked");for(var a in this.settings.alerts)this.settings.alerts[a]=$("#dialog-checkbox-"+a).is(":checked");this.f("notify",this.settings.notify);this.saveSettings();Dialog.closeDialog()},Ia:function(){this.settings.k.enabled=
$("#dialog-checkbox-enabled").is(":checked");this.settings.k.limit=~~$('input[name="chat-limit"]').val();this.f("chatlimit",this.settings.k.enabled);if(this.settings.k.enabled){var a=$("#chat-messages").children("div"),b=a.length,c=0;a.each(function(){++c<b-plugCubed.settings.k.limit&&$(this).remove()})}this.saveSettings();Dialog.closeDialog()},Ja:function(){for(var a in this.settings.colors){var b=$('input[name="'+a+'"]');b.val(b.data("ph"));b.parents(".dialog-input-container").find(".dialog-input-label").css("color",
"#"+b.val())}},Ka:function(){this.settings.customColors=$("#dialog-checkbox-enabled").is(":checked");for(var a in this.settings.colors){var b=$('input[name="'+a+'"]'),c=this.settings.colors,g=a,k;if(!(k=""===b.val()))k=b.val(),k=!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test("#"===k.substr(0,1)?k:"#"+k);c[g]=k?b.data("ph"):b.val()}this.wa();this.f("colors",this.settings.customColors);this.saveSettings();Dialog.closeDialog()},onVoteUpdate:function(a){if(a&&a.user){var b=Models.room.userHash[a.user.id];
this.i();1===b.C?b.A--:-1===b.C&&b.F--;1===a.vote?b.A++:-1===a.vote&&b.F++;b.C=a.vote}},V:function(a){var b=API.getMedia();this.settings.notify===e&&this.settings.alerts.curate===e&&this.log(a.user.username+" added "+b.author+" - "+b.title,f,this.settings.colors.curate);Models.room.userHash[a.user.id].curated=e;this.i()},W:function(a){this.settings.notify===e&&(this.settings.alerts.ra===e&&this.log("Stats:   "+a.lastPlay.score.positive+" woots -- "+a.lastPlay.score.negative+" mehs -- "+a.lastPlay.score.curates+
" curates",f,this.settings.colors.va),this.settings.alerts.ta===e&&this.log("Now Playing: "+a.media.title+" by "+a.media.author+"<br />Played by: "+a.dj.username,f,this.settings.colors.xa));setTimeout($.proxy(this.La,this),1E3*Math.Qa());(Models.user.getPermission()>=Models.user.BOUNCER||this.J(Models.user.data.id))&&this.Ma(a.media.id);plugCubed.history.unshift({id:a.media.id,author:a.media.author,title:a.media.title,ea:h,user:{id:a.dj.id,username:a.dj.username}});plugCubed.history.splice(50,plugCubed.history.length-
50);this.settings.B&&0>this.settings.q.indexOf(a.media.id)&&(setTimeout(function(){Playback.setVolume(Playback.lastVolume)},800),this.settings.B=h);!this.settings.B&&-1<this.settings.q.indexOf(a.media.id)&&(setTimeout(function(){Playback.setVolume(0)},800),this.settings.B=e,this.log(a.media.title+" auto-muted.",f,this.colors.g));this.i();a=API.getUsers();for(var b in a)a[b].C=0},La:function(){this.settings.autowoot&&0>this.settings.q.indexOf(Models.room.data.media.id)&&this.ya();if("block"===$("#button-dj-waitlist-join").css("display")&&
this.settings.autojoin)Room.onWaitListJoinClick()},ya:function(){if(!(Models.room.data.djs===d||0===Models.room.data.djs.length)){var a=Models.room.data.djs[0];a===f||a==API.getSelf()||$("#button-vote-positive").click()}},X:function(a){this.settings.notify===e&&this.settings.alerts.join===e&&this.log(Utils.cleanTypedString(a.username+" joined the room"),f,this.settings.colors.join);a=Models.room.userHash[a.id];a.A===d&&(a.A=0);a.F===d&&(a.F=0);a.C===d&&(a.C=0);a.joinTime===d&&(a.joinTime=this.S());
this.i()},Y:function(a){this.settings.notify===e&&this.settings.alerts.leave===e&&this.log(Utils.cleanTypedString(a.username+" left the room"),f,this.settings.colors.leave);this.i()},J:function(a){return"50aeb31696fba52c3ca0adb6"==a||"50aeb077877b9217e2fbff00"==a},ma:function(a){return"5112c273d6e4a94ec0554792"==a||"50b1961c96fba57db2230417"==a},ha:function(a){var b=0>a.message.indexOf("@")&&this.J(a.fromID);if("mention"==a.type&&Models.room.data.staff[a.fromID]&&Models.room.data.staff[a.fromID]>=
Models.user.BOUNCER||b)-1<a.message.indexOf("!disable")&&(this.settings.autojoin?(this.settings.autojoin=h,this.f("join",this.settings.autojoin),this.saveSettings(),API.waitListLeave(),API.sendChat("@"+a.from+" Autojoin disabled")):API.sendChat("@"+a.from+" Autojoin was not enabled")),-1<a.message.indexOf("!afkdisable")&&(this.settings.autorespond?(this.settings.autorespond=h,this.f("autorespond",this.settings.autorespond),this.saveSettings(),API.sendChat("@"+a.from+" AFK message disabled")):API.sendChat("@"+
a.from+" AFK message was not enabled"))},U:function(a){this.ha(a);"mention"==a.type&&(this.settings.autorespond&&!this.settings.recent)&&(this.settings.recent=e,setTimeout(function(){plugCubed.settings.recent=h;plugCubed.saveSettings()},18E4),API.sendChat("@"+a.from+" "+this.settings.awaymsg));if(this.settings.k.enabled){a=$("#chat-messages").children("div");var b=a.length,c=0;a.each(function(){++c<b-plugCubed.settings.k.limit&&$(this).remove()})}},i:function(){this.settings.userlist&&this.Z()},Ca:function(){(new HistorySelectService).successCallback=
$.proxy(this.Ga,this)},Ga:function(a){this.history=[];for(var b in a){var c=a[b];this.history.push({id:c.media.id,author:c.media.author,title:c.media.title,ea:h,user:{id:c.user.id.toString(),username:c.user.username}})}},u:function(){this.history[1].ea=e},Ma:function(a){var b=-1,c;for(c in this.history){var g=this.history[c];if(g.id==a&&51>~~c+2&&(b=~~c+2,!g.ea))return Popout==f||Popout==d?(document.getElementById("chat-sound").playMentionSound(),setTimeout(function(){document.getElementById("chat-sound").playMentionSound()},
100)):(Popout.document.getElementById("chat-sound").playMentionSound(),setTimeout(function(){Popout.document.getElementById("chat-sound").playMentionSound()},100)),Models.chat.onChatReceived({type:"system",message:"Song is in history ("+b+" of "+this.history.length+")",language:Models.user.data.language})}if(0<b)return Models.chat.onChatReceived({type:"system",message:"Song is in history ("+b+" of "+this.history.length+"), but was skipped on the last play",language:Models.user.data.language})},S:function(){var a=
new Date,b=a.getMinutes();return a.getHours()+":"+((10>b?"0":"")+b)},ja:function(a){if(this.G(a)===e)return("/stream on"==a||"/stream off"==a)&&plugCubed.f("stream",!DB.settings.streamDisabled),"/afk"==a&&plugCubed.settings.autojoin&&(plugCubed.settings.autojoin=h,plugCubed.f("join",h),plugCubed.saveSettings()),e;if(0===a.indexOf("/commands")){a=[["/nick","change username"],["/idle","set status to idle"],["/avail","set status to available"],["/afk","set status to afk"],["/work","set status to working"],
["/sleep","set status to sleeping"],["/join","join dj booth/waitlist"],["/leave","leaves dj booth/waitlist"],["/whoami","get your own information"],["/mute","set volume to 0"],["/automute","register currently playing song to automatically mute on future plays"],["/unmute","set volume to last volume"],["/woot","woots current song"],["/meh","mehs current song"],["/refresh","refresh the video"],["/ignore (username)","ignore all chat messages from user"],["/curate","add current song to your selected playlist"],
["/getpos","get current waitlist position"],["/version","displays version number"],["/commands","shows this list"],["/link","paste link to plugCubed website in chat"]];var b="<table>",c;for(c in a)b+="<tr><td>"+a[c][0]+"</td><td>"+a[c][1]+"</td></tr>";b+="</table>";if(Models.user.hasPermission(Models.user.BOUNCER)){a=[["/whois (username)","gives general information about user",Models.user.BOUNCER],["/skip","skip current song",Models.user.BOUNCER],["/kick (username)","kicks targeted user",Models.user.BOUNCER],
["/lock","locks DJ booth",Models.user.MANAGER],["/unlock","unlocks DJ booth",Models.user.MANAGER],["/add (username)","adds targeted user to dj booth/waitlist",Models.user.BOUNCER],["/remove (username)","removes targeted user from dj booth/waitlist",Models.user.BOUNCER]];var g="<table>";for(c in a)Models.user.hasPermission(a[c][2])&&(g+="<tr><td>"+a[c][0]+"</td><td>"+a[c][1]+"</td></tr>");Dialog.qa(b,g+"</table>")}else Dialog.qa(b);return e}if("/idle"==a)return Models.user.changeStatus(-1),e;if("/avail"==
a||"/available"==a)return Models.user.changeStatus(0),e;if("/brb"==a||"/away"==a)return Models.user.changeStatus(1),plugCubed.settings.autojoin&&(plugCubed.settings.autojoin=h,plugCubed.f("join",h),plugCubed.saveSettings()),e;if("/work"==a||"/working"==a)return Models.user.changeStatus(2),e;if("/sleep"==a||"/sleeping"==a)return Models.user.changeStatus(3),plugCubed.settings.autojoin&&(plugCubed.settings.autojoin=h,plugCubed.f("join",h),plugCubed.saveSettings()),e;if("/join"==a)return Room.onWaitListJoinClick(),
e;if("/leave"==a)return API.waitListLeave(),e;if("/whoami"==a)return plugCubed.T(Models.user.data.id),e;if("/woot"==a)return $("#button-vote-positive").click(),e;if("/meh"==a)return $("#button-vote-negative").click(),e;if("/refresh"==a)return $("#button-refresh").click(),e;if("/version"==a)return plugCubed.log("Running plug&#179; version "+plugCubed.version.major+"."+plugCubed.version.minor+"."+plugCubed.version.patch,f,plugCubed.colors.D),e;if("/mute"==a)return Playback.setVolume(0),e;if("/link"==
a)return Models.chat.sendChat("plugCubed : http://tatdk.github.io/plugCubed"),e;if("/unmute"==a)return Playback.setVolume(Playback.lastVolume),e;if(plugCubed.R()&&"/muteone"==a||plugCubed.R()&&"/singlemute"==a)return $("#button-sound").click(),$("#button-sound").click(),e;if(0===a.indexOf("/nick "))return Models.user.changeDisplayName(a.substr(6)),e;if(0===a.indexOf("/curate"))return new DJCurateService(Models.playlist.selectedPlaylistID),setTimeout(function(){Dialog.closeDialog()},500),e;if("/nextsong"==
a){a=Models.playlistMedia(Models.playlist.selectedPlaylistID).data[0];a.id===Models.room.data.media.id&&Models.room.data.currentDJ===Models.user.data.id&&(a=Models.playlistMedia(Models.playlist.selectedPlaylistID).data[1]);b=-1;for(c in plugCubed.history)if(plugCubed.history[c].id==a.id&&51>~~c+1){b=~~c+1;break}return 0<b?(log('<span style="color:'+plugCubed.colors.D+'">Your next queued song is '+a.title+" by "+a.author+'</span><br /><span style="color:'+plugCubed.colors.oa+'"><strong> Warning: This song is still in the history ('+
b+" of "+plugCubed.history.length+")</strong></span>"),e):(plugCubed.log("Your next queued song is "+a.title+" by "+a.author,f,plugCubed.colors.D),e)}if("/automute"==a)return 0>plugCubed.settings.q.indexOf(Models.room.data.media.id)?(plugCubed.settings.q.push(Models.room.data.media.id),plugCubed.settings.B=e,Playback.setVolume(0),plugCubed.log(Models.room.data.media.title+" registered to auto-mute on future plays.",f,plugCubed.colors.g)):(plugCubed.settings.q.splice(plugCubed.settings.q.indexOf(Models.room.data.media.id),
1),plugCubed.settings.B=h,Playback.setVolume(Playback.lastVolume),plugCubed.log(Models.room.data.media.title+" removed from automute registry.",f,plugCubed.colors.g)),plugCubed.saveSettings(),e;if("/alertsoff"==a)return plugCubed.settings.notify&&(plugCubed.log("Join/leave alerts disabled",f,plugCubed.colors.D),plugCubed.settings.notify=h,plugCubed.f("notify",h)),e;if("/alertson"==a)return plugCubed.settings.notify||(plugCubed.log("Join/leave alerts enabled",f,plugCubed.colors.D),plugCubed.settings.notify=
e,plugCubed.f("notify",e)),e;if(0===a.indexOf("/getpos")){c=plugCubed.getUser(a.substr(8));a=c===f?Models.user.data:c;b=Models.room.getWaitListPosition(a.id);if(b!==f)plugCubed.log("Position in waitlist "+b+"/"+Models.room.data.waitList.length,f,plugCubed.colors.g);else{b=-1;for(c=0;c<Models.room.data.djs.length;c++)b=Models.room.data.djs[c].user.id===a.id?c:b;0>b?plugCubed.log("Not in waitlist nor booth",f,plugCubed.colors.g):0===b?plugCubed.log((a.id===Models.user.data.id?"You":a.username)+" are currently DJing",
f,plugCubed.colors.g):1===b?plugCubed.log((a.id===Models.user.data.id?"You":a.username)+" are DJing next",f,plugCubed.colors.g):plugCubed.log("Position in booth "+(b+1)+"/"+Models.room.data.djs.length,f,plugCubed.colors.g)}return e}if(0===a.indexOf("/ignore ")||0===a.indexOf("/unignore "))return a=plugCubed.getUser(a.substr(8)),a===f?(plugCubed.log("User not found",f,plugCubed.colors.g),e):a.id===Models.user.data.id?(plugCubed.log("You can't ignore yourself",f,plugCubed.colors.g),e):-1<plugCubed.settings.L.indexOf(a.id)?
(plugCubed.settings.L.splice(plugCubed.settings.L.indexOf(a.id),1),plugCubed.saveSettings(),log("You are no longer ignoring "+a.username),e):(plugCubed.settings.L.push(a.id),plugCubed.saveSettings(),log("You are now ignoring "+a.username),e);if(plugCubed.J(Models.user.data.id)&&0===a.indexOf("/whois "))return plugCubed.T(a.substr(7)),e;if(Models.user.hasPermission(Models.user.BOUNCER)){if(0===a.indexOf("/skip")){if(Models.room.data.djs[0].user.id==Models.user.data.id)Room.onSkipClick();else c=a.substr(5).trim(),
a=plugCubed.getUser(Models.room.data.currentDJ),c&&API.sendChat((a!=f?"@"+a.username+" - ":"")+"Reason for skip: "+c),new ModerationForceSkipService;return e}if(0===a.indexOf("/whois "))return plugCubed.T(a.substr(7)),e;if(0===a.indexOf("/kick "))if(0<a.indexOf("::")){c=a.substr(6).split(":: ");b=60;if(2==c.length)return!isNaN(parseInt(c[1],10))&&isFinite(c[1])&&(b=parseFloat(c[1])),a=plugCubed.getUser(c[0]),new ModerationKickUserService(a.id,!isNaN(parseInt(c[1],10))&&isFinite(c[1])?" ":c[1],b),
e;if(3==c.length)return b=parseFloat(c[2]),a=plugCubed.getUser(c[0]),new ModerationKickUserService(a.id,c[1],b),e}else return plugCubed.ba(a.substr(6),"kick"),e;if(0===a.indexOf("/add "))return plugCubed.ba(a.substr(5),"adddj"),e;if(0===a.indexOf("/remove "))return plugCubed.ba(a.substr(8),"removedj"),e}if(Models.user.hasPermission(Models.user.MANAGER)){if("/lock"===a)return new RoomPropsService(document.location.href.split("/")[3],e,Models.room.data.waitListEnabled,Models.room.data.maxPlays,Models.room.data.maxDJs),
e;if("/unlock"===a)return new RoomPropsService(document.location.href.split("/")[3],h,Models.room.data.waitListEnabled,Models.room.data.maxPlays,Models.room.data.maxDJs),e}return h}});
if(localStorage.ca===d){var plugCubed=f;new (Class.extend({init:function(){$("#overlay-container").append($("#avatar-overlay").clone(h,h).attr("id","plugCubedLang-overlay").width(800).height(600).css("position","absolute"));$("#plugCubedLang-overlay").find(".overlay-title").html("plug&#179; language");$("#plugCubedLang-overlay").find("#avatar-sets").remove();$("#plugCubedLang-overlay").find("#avatar-panel").attr("id","plugCubedLang-panel").css("padding-top","60px");$("#plugCubedLang-overlay").find(".overlay-close-button").click($.proxy(this.hide,
this));this.Fa()},show:function(){UserListOverlay.hide();$("#lobby-overlay").hide();$("#media-overlay").hide();$("#avatar-overlay").hide();$("#plugCubedLang-overlay").show();$("#overlay-container").show();this.draw()},hide:function(){UserListOverlay.hide();$("#lobby-overlay").hide();$("#media-overlay").hide();$("#avatar-overlay").hide();$("#plugCubedLang-overlay").hide();$("#overlay-container").hide()},draw:function(){$("#plugCubedLang-panel").html("").scrollTop(0);var a=this.M.length,b=$("<div/>");
if(5<a)for(var c=0;c<a/5;c++)b.append(this.drawRow(this.M.slice(5*c,5*c+5)).css("top",75*c));else b.append(this.drawRow(this.M).css("top",75*c));$("#plugCubedLang-panel").append(b);$(".lang-button").click($.proxy(this.Na,this))},drawRow:function(a){for(var b=$("<div/>").addClass("lang-row"),c=a.length,g=5==c?0:4==c?75:3==c?150:2==c?225:300,k=0;k<c;++k){var r=$("<div/>").addClass("lang-button").css("display","inline-block").css("left",g).data("language",a[k].file).css("cursor","pointer").append($("<img/>").attr("src",
"https://rawgithub.com/TATDK/plugCubed/1.7.0/flags/flag."+a[k].file+".png").attr("alt",a[k].name).height(75).width(150));b.append(r);g+=150}return b},Na:function(a){a=$(a.currentTarget);localStorage.ca=a.data("language");plugCubed=new u;this.hide()},Fa:function(){var a=this;this.M=[];$.getJSON("https://rawgithub.com/TATDK/plugCubed/1.7.0/lang.txt",function(b){a.M=b;a.show()}).done(function(){0===a.M.length&&log('<span style="color:#FF0000">Error loading plugCubed</span>')})}}))}else plugCubed=new u;
plugCubed.na=e;
//# sourceMappingURL=https://rawgithub.com/TATDK/plugCubed/1.7.0/plugCubed.min.js.map 
